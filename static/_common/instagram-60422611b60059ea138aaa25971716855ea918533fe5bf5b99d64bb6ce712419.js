(function(){(function(){var s,l,m,t;return s=this.jQuery,l=function(){function n(n,e){if(this.accessToken=null!=n?n:null,this.apiPrologue=null!=e?e:"https://graph.instagram.com/me",null==this.accessToken)throw new Error("You must provide an accessToken parameter when instantiating an APIClient object.")}return n.prototype.requestEndpoint=function(n){var e;return e=0<n.indexOf("?")?n+"&access_token="+this.accessToken:n+"/?access_token="+this.accessToken,s.ajax({url:this.apiPrologue+"/"+e,dataType:"jsonp"})},n.prototype.getRecentMedia=function(n){var e,t;return t=this.apiPrologue,e={dataType:"jsonp",data:{access_token:this.accessToken,fields:"media.limit("+n+"){media_url,permalink,thumbnail_url,username}"}},this.fetchDataUntilGotEnough(t,e,n)},n.prototype.fetchDataUntilGotEnough=function(n,e,u){var c,t,r,d,g;return g=[],c=s.Deferred(),r=function(n){var e,t,r,a,o,i,l,s;return g=g.concat(null!=(e=null!=n&&null!=(t=n.media)?t.data:void 0)?e:[]),null!=(null!=n?n.error:void 0)?c.resolve(n):g.length>=u?c.resolve({data:g,count:u}):(null!=n&&null!=(r=n.media)&&null!=(a=r.data)?a.length:void 0)&&null==(null!=n&&null!=(o=n.media)&&null!=(i=o.paging)?i.next:void 0)?("undefined"!=typeof Raven&&null!==Raven&&Raven.captureMessage("Instagram account doesn\u2019t have enough images"),c.resolve({data:g})):null!=(null!=n&&null!=(l=n.media)&&null!=(s=l.paging)?s.next:void 0)?d(n.media.paging.next):c.resolve(m.constructError(m.UNKNOWN_ERROR))},t=function(n){try{return c.resolve(JSON.parse(n.responseText))}catch(e){return c.resolve(m.constructError(m.UNKNOWN_ERROR))}},(d=function(n,e){return null==e&&(e={dataType:"jsonp"}),s.ajax(n,e).then(r,t)})(n,e),c},n}(),m=this.instagram={NO_ACCESS_TOKEN_ERROR:"IGApiException",INVALID_ACCESS_TOKEN_ERROR:"OAuthException",UNKNOWN_ERROR:"unknown",constructError:function(n){return{error:{type:n}}},config:(t=this,function(){var n,e;return null!=(n=t.social)&&null!=(e=n.instagram)?e.accessToken:void 0}),populate:function(n,o){var e,t,i;if(null!=n&&(n=n.filter(function(n,e){return 1===s(e).find("[data-social-type='instagram']").length})),0<(e=null!=n?n:s("[data-social-type='instagram']").closest("._4ORMAT_content_page_row")).length)return null==(t=m.config())?(m.render({el:e,error:m.NO_ACCESS_TOKEN_ERROR}),"function"==typeof o?o(e):void 0):(i=new l(t),e.each(function(n,e){var t,r,a;return t=null!=(a=(r=s(e).find(".js-format-instagram-wrapper")[0]).dataset.imageCount)?a:6,i.getRecentMedia(t).then(function(n){return null!=(null!=n?n.error:void 0)?m.render({el:e,error:n.error.type}):m.render({data:n.data,el:e,settings:r.dataset}),"function"==typeof o?o(s(e)):void 0})}))},updateImageCount:function(e,t,r){var n,a,o,i;return null==(n=m.config())?(m.render({el:e,error:m.NO_ACCESS_TOKEN_ERROR}),"function"==typeof r?r(s(e)):void 0):(o=new l(n),a=null!=(i=t.imageCount)?i:6,o.getRecentMedia(a).then(function(n){return null!=(null!=n?n.error:void 0)?m.render({el:e,error:n.error.type}):m.render({data:n.data,el:e,settings:t}),"function"==typeof r?r(s(e)):void 0}))},render:function(n){var e,t,r,a,o,i,l;return l=n.settings,a=n.data,o=n.el,r=null!=(i=n.error)?i===m.NO_ACCESS_TOKEN_ERROR?"<div class='js-format-instagram-container format-instagram-container error error-no-access'>\n</div>":i===m.INVALID_ACCESS_TOKEN_ERROR?"<div class='js-format-instagram-container format-instagram-container error error-failed-access'>\n</div>":"<div class='js-format-instagram-container format-instagram-container error error-unknown empty'>\n</div>":0===a.length?"<div class='js-format-instagram-container format-instagram-container error empty'>\n</div>":m.renderImages({data:a,el:o,settings:l}),0<(t=(e=s(o)).find(".js-format-instagram-container ")).length?t.replaceWith(r):e.find(".js-format-instagram-wrapper").append(r),e.toggleClass("_4ORMAT_site_hidden",null!=i||0===a.length)},renderImages:function(n){var e,t,r,a,o;return e=n.data,t=n.el,o=n.settings,r=e.reduce(function(n,e){return n+'<div class="format-instagram-preview">\n  <a href="'+e.permalink+'" target="_blank" rel="noopener">\n    <div class="format-instagram-preview-image"\n      style="background-image:url('+(e.thumbnail_url||e.media_url)+');"></div>\n  </a>\n</div>'},""),r+=m.renderAttribution(e),"<div class='js-format-instagram-container format-instagram-container image-row-count-"+(null!=(a=o.imagesPerRow)?a:3)+"'>\n  "+r+"\n</div>"},renderAttribution:function(n){return 0<n.length?'<div class="format-instagram-attribution">\n  Follow\n  <a href="https://www.instagram.com/'+n[0].username+'/" target="_blank" rel="noopener">@'+n[0].username+"</a>\n  on Instagram\n</div>":""}},s(function(){if(!_4ORMAT_DATA.page.content_editable)return m.populate()})}).call(_4ORMAT)}).call(this);