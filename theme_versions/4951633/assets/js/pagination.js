$(function(){"use strict";var t={fail:function(i){if(0!==i.status||"abort"!==i.statusText)return"403"===i.status||403===i.status?t.refresh():t.unknown()},unknown:function(){return $(".gallery-error-overlay").show(),$(".gallery-error-overlay .error_unknown").show()},refresh:function(){return $(".gallery-error-overlay").show(),$(".gallery-error-overlay .error_refresh").show()}};window.GalleryPagination={init:function(){this.gallerySize=0,this.container=$(".asset-container"),this.gallery=this.container.find("#masonry-gallery"),this.assets=null,this.loadMoreInterval=null,this.in_progress=!1,this.finished=!1,this.events();var t=window.location.hash,i=t.split("-")[1];this.startSlide=0,isNaN(i)||""===i||(this.startSlide=i),$("#loading-spinner").hide(),this.scrollToStartSlide()},scrollToStartSlide:function(){if(this.gallery.find(".asset").length-1>=this.startSlide)return void $("#loading-spinner").hide();$("#loading-spinner").show(),this.ajaxCall()},disable:function(){return $(".js-load-more").remove(),window.CLIENT_ACCESS_PAGINATION_DISABLED=!0},isDisabled:function(){return!0===window.GALLERY_PAGINATION_DISABLED||$(".js-load-more").length<1},ajaxCall:function(){var i,n;if(!this.finished)return this.in_progress?this.in_progress:this.isDisabled()?void clearInterval(this.loadMoreInterval):($("body").addClass("loading"),n=this.lastPosition(),i=window.location.origin+window._4ORMAT_DATA.page.url+".json?asset_offset_position="+n,this.in_progress=$.ajax({url:i}).fail(t.fail).done(function(t){return function(i){if($(".js-load-more").data("last-position",i.page.last_asset_position),t.gallery.append(i.page.rendered_html),_4ORMAT_DATA.page.assets=_4ORMAT_DATA.page.assets.concat(i.page.assets),window.Amazon._initMasonry(),window.Amazon._initGalleryBinds(),window.Amazon._animationCascade("forward"),window.Amazon._reinit(),$("#loading-spinner").hide(),$(".gallery-overlay-navigation").attr("disabled",!1),i.page.last_asset_position<0)return $(".js-load-more").remove(),t.finished=!0,t.gallery.find(".asset").length<t.startSlide&&(t.startSlide=t.gallery.find(".asset").length-1,$(".gallery-overlay").flexslider(t.startSlide)),t.scrollToStartSlide(),clearInterval(t.loadMoreInterval);t.in_progress=!1,t.scrollToStartSlide(),$("body").removeClass("loading")}}(this)).always(function(t){return function(){return t.in_progress=!1}}(this)))},lastPosition:function(){return $(".js-load-more").data("last-position")},events:function(){if(!(this.gallery.length<1))return this.loadMoreInterval=setInterval(function(t){return function(){var i,n,e,r;if(n=t.gallery.offset().top,i=t.gallery.height(),e=$(window).height(),r=$(window).scrollTop(),e+r>n+i&&!$("body").hasClass("loading"))return t.ajaxCall()}}(this),200)},LOADING_SENSIVITY:2,loadAsset:function(t){var i;if(this.lastPosition()-t-1<this.LOADING_SENSIVITY)return(i=this.ajaxCall())&&i.then(function(i){return function(){return i.loadAsset(t)}}(this))}},GalleryPagination.init()});